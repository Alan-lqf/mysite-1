{% extends "mysite/base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load avatar_tags %}

{% block title %}
    {{ title }}
{% endblock %}


{% block additional_head %}

    <link href="{% static 'blogs/blog-home.css' %}" rel="stylesheet">
    <link href="{% static 'blogs/myblog.css' %}" rel="stylesheet">
    <script src="{% static 'blogs/jquery.truncate.js' %}" type="text/javascript"></script>
    <script src="{% static 'blogs/render-content.js' %}" type="text/javascript"></script>

    <!-- Custom CSS -->
    <link href="{% static 'accounts/accounts-dashboard.css' %}" rel="stylesheet">

    <script>
        function ajax_blog_posts() {
            $.ajax({
                type:"GET",
                url: "{% url 'user_blog_posts' %}",
                data: {"user_id": {{ request.user.id }} },
                success: function(result) {
                    $('#blog-posts').html(result);
                    update_marked_truncate();
                    $('pre code').each(function(i, block) {
                        hljs.highlightBlock(block);
                    });
                },
                error: function(jqXHR, exception) {
                    $('#blog-posts').html(exception);
                }
            });
        }

        function ajax_comment_posts() {
            $.ajax({
                type:"GET",
                url: "{% url 'user_comment_posts' %}",
                data: {"user_id": {{ request.user.id }} },
                success: function(result) {
                    $('#comment-posts').html(result);
                },
                error: function(jqXHR, exception) {
                    $('#comment-posts').html(exception);
                }
            });
        }

        function ajax_comment_received() {
            $.ajax({
                type:"GET",
                url: "{% url 'user_comment_received' %}",
                data: {"user_id": {{ request.user.id }} },
                success: function(result) {
                    $('#comment-received').html(result);
                },
                error: function(jqXHR, exception) {
                    $('#comment-received').html(exception);
                }
            });
        }


        $(document).ready(function () {
            $('a[data-toggle="pill"]').on('shown.bs.tab', function (e) {
                var target = $(e.target).attr("href");// activated tab
                if (target == "#blog-posts-tab")
                {
                    ajax_blog_posts();
                }
                else if (target == "#blog-comments-tab")
                {
                    ajax_comment_posts();
                }
                else if (target == "#blog-replies-receive-tab")
                {
                    ajax_comment_received();
                }
            });
            // default render blog_post
            ajax_blog_posts();
        });
    </script>

{% endblock %}


{% block content %}
<div class="accounts-panel-div">
    <div class="profile-avatar text-center">
        {% avatar request.user 96 %}<br/>
        <div class="profile-nav">
            <a href="{% url 'avatar_change' %}" class="btn btn-success">Change Avatar</a>
            <a href="{% url 'avatar_delete' %}" class="btn btn-danger">Manage Avatar</a>
            <a href="{% url 'profile_edit' %}" class="btn btn-info">Edit Profile</a>
        </div>
    </div>

    <ul class="nav nav-pills">
        <li class="active"><a href="#blog-posts-tab" data-toggle="pill">My blog posts</a></li>
        <li><a href="#blog-comments-tab" data-toggle="pill">My blog comments</a></li>
        <li><a href="#blog-replies-receive-tab" data-toggle="pill">Replies to me</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane fade in active" id="blog-posts-tab">
             <div class="profile-content-div" id="blog-posts">
                <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                <span class="sr-only">Loading...</span>
            </div>
        </div>

        <div class="tab-pane fade" id="blog-comments-tab">
            <div class="profile-content-div" id="comment-posts">
                <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                <span class="sr-only">Loading...</span>
            </div>
        </div>
        <div class="tab-pane fade" id="blog-replies-receive-tab">
            <div class="profile-content-div" id="comment-received">
                <i class="fa fa-spinner fa-spin fa-2x fa-fw"></i>
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>
</div>


{% endblock %}
